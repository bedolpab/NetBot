<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="css/index.css" />
    <link rel="shortcut icon" href="#" />
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
  </head>
  <body>  
<div class="container">
  <div class="livestream">
    <div class="source">
      <form>
        <label for="source-label">code:</label>
        <input type="text" name="source-link" id="source-link" />
        <button type="submit">find</button>
      </form>
    </div>
    <div class="video">
      <div class="video-stats">
        <p id="live"></p>
        <p id="viewCount"></p>
      </div>
      <p id="title"></p>
    </div>
    <div id="player"></div>
    <div class="specs-time">
      <p id="publishedAt"></p>
      <p id="actualStartTime"></p>
      <p id="uploadStatus"></p>
      <p id="current-time"></p>
    </div>
    <div class="specs-info">
      <p id="channelID"></p>
      <p id="channelTitle"></p>
    </div>
    </div>
    <div class="analysis">
      <!--extract frame by frame the youtube video embded in the iframe -->
    </div>
  </div>
</div>
    <script>
      let player;
      let apiKey = "";

      const form = document.querySelector(".source form");
      const input = document.querySelector(".source input");

      // Event listener on submit
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          videoId: input.value,
          playerVars: {
            'playsinline': 1,
            'autoplay': 1,
            'color': 'white',
            'controls': 0,
            'enablejsapi': 1,
            'modestbranding': 1
          },
          events: {
            'onReady': getVideoData(input.value),
            'onStateChange': onPlayerStateChange
          }
        });
      })

      const getVideoData = async (videoId) => {
          // Make the API request
          const response = await fetch(
            `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&key=${apiKey}&part=snippet,contentDetails,statistics,liveStreamingDetails,status,recordingDetails`
          );
          const data = await response.json();
          let videoData = {
          id: data.items[0].id,
          channelID: data.items[0].snippet.channelId,
          channelTitle: data.items[0].snippet.channelTitle,
          liveBool: data.items[0].snippet.liveBroadcastContent,
          publishedAt: data.items[0].snippet.publishedAt,
          title: data.items[0].snippet.title,
          statistics: data.items[0].statistics.viewCount,
          activeLiveChatId:
            data.items[0].liveStreamingDetails.activeLiveChatId,
          actualStartTime: data.items[0].liveStreamingDetails.actualStartTime,
          uploadStatus: data.items[0].status.uploadStatus,
          license: data.items[0].status.license,
        };
        if (videoData.liveBool === "live") {
          let live_status = document.querySelector("#live");
          let viewCount = document.querySelector("#viewCount");
          live_status.innerHTML = "LIVE";
          viewCount.innerHTML = videoData.statistics;
        }

        let publishedAt = document.querySelector("#publishedAt");
        let actualStartTime = document.querySelector("#actualStartTime");
        let uploadStatus = document.querySelector("#uploadStatus");
        publishedAt.innerHTML =
          "Published at: " + "<br><span>" + videoData.publishedAt + "</span>";
        actualStartTime.innerHTML =
          "Actual start time: " +
          "<br><span>" +
          videoData.actualStartTime +
          "<br></span>";
        uploadStatus.innerHTML =
          "Upload status: " +
          "<br><span>" +
          videoData.uploadStatus +
          "</span>";

        let channelTitle = document.querySelector("#channelTitle");
        let channelID = document.querySelector("#channelID");
        let title = document.querySelector("#title");
        channelTitle.innerHTML =
          "Channel title: " + "<span>" + videoData.channelTitle + "</span>";
        channelID.innerHTML =
          "Channel ID: " + "<span>" + videoData.channelID + "</span>";
        title.innerHTML = videoData.title;

        let license = document.querySelector("#license");
        license.innerHTML = "&copy " + videoData.license;
      };

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        event.target.playVideo();
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      var done = false;
      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
          setTimeout(stopVideo, 6000);
          done = true;
        }
      }
      function stopVideo() {
        player.stopVideo();
      }
    </script>
  </body>

</html>